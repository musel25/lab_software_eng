flowchart TD
    %% ─── lanes / actors shown with dashed refs only ───
    classDef actor fill:#e6f7ff,stroke:#3399ff,stroke-dasharray:4 2;
    User[[User]]:::actor
    Admin[[Admin]]:::actor
    AccessPoint[[Access Point]]:::actor

    %% ─── nodes ───
    start((Start))
    read[readSecurityCard]
    validate[validateSecurityCard]
    display[displayCardStatus]
    d1{CardStatus\nValid?}
    logExit[logExitData]
    unlock[unlockAccessPoint]
    lock[lockAccessPoint]
    end((End))

    flagFail[flagSecurityCardFailure]
    d2{ScFailCount<br/>&lt; 3?}
    alarm[alarm]
    reset[resetAlarm]

    checkTL[checkForTimeLimitViolations]

    %% ─── control flow ───
    start --> read --> validate --> display --> d1
    d1 -- yes --> logExit --> unlock --> lock --> end
    d1 -- no  --> flagFail --> d2
    d2 -- yes --> read                          %% retry loop
    d2 -- no  --> alarm --> reset --> end

    %% ─── concurrent admin check (simplified) ───
    start -.-> checkTL
    checkTL -.-> end

    %% ─── dashed actor associations ───
    User -.-> read
    User -.-> validate
    User -.-> display
    AccessPoint -.-> unlock
    AccessPoint -.-> lock
    Admin -.-> checkTL
    Admin -.-> flagFail
    Admin -.-> alarm
    Admin -.-> reset
